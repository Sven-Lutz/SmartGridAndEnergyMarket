# configs/de_sample.yml

# --- Metadaten / Scope-Beschreibung ---

scope: de_sample
description: "Deutsches Demo-Scope mit Fokus auf kommunale Klimaschutz- und Energie-Seiten (Karlsruhe, München)."

country: "DE"
level: "municipality"
region: "sample"

dataset_id: "de_sample"
version: "0.1.0"
created: "2025-12-08"

# --- Datenpfade (von bestehendem Code genutzt) ---

data_root: "data/de_sample"
municipalities_file: "data/de_sample/meta/municipalities.ndjson"

# Optional: zusätzliche, standardisierte Pfade für die Pipeline
paths:
  raw:
    documents: "data/de_sample/raw/documents_raw.ndjson"
    meta: "data/de_sample/raw/meta.ndjson"

  extracted:
    documents: "data/de_sample/extracted/documents_extracted.ndjson"
    policy_candidates: "data/de_sample/extracted/policy_candidates.ndjson"

  classified:
    measures_baseline: "data/de_sample/classified/measures_baseline.ndjson"
    measures_labeled: "data/de_sample/classified/measures_labeled.ndjson"

  labeling:
    export_csv: "data/de_sample/labeling/policy_candidates_for_labeling.csv"
    labeled_csv: "data/de_sample/labeling/policy_candidates_labeled.csv"

  eval:
    goldstandard: "data/de_sample/eval/gold_measures.ndjson"
    reports_dir: "data/de_sample/eval/reports"

  results:
    measures_csv: "data/de_sample/results/measures_de_sample.csv"

  meta:
    discovered_seeds: "data/de_sample/meta/discovered_seeds.ndjson"

  logs:
    crawl_log: "data/de_sample/logs/crawl.log"
    pipeline_log: "data/de_sample/logs/pipeline.log"

# --- Crawler- / Discovery-Parameter (können mit scopes.yml harmonisiert werden) ---

crawl:
  max_municipalities: 10
  max_pages_per_municipality: 50
  max_depth: 2
  user_agent: "k3-crawler/0.1 (de_sample)"
  obey_robots_txt: true
  request_timeout_seconds: 15
  retry_attempts: 3
  parallel_requests: 4

  allowed_mime_types:
    - "text/html"
    - "application/pdf"
  disallowed_mime_types:
    - "image/*"
    - "video/*"

discovery:
  enable_llm_domain_resolution: false
  min_domain_confidence: 0.7
  max_seeds_per_municipality: 5
  write_discovered_seeds: "data/de_sample/meta/discovered_seeds.ndjson"

# --- Extraktions-/Filter- und Klassifikations-Parameter (Sample-Empfehlungen) ---

extraction:
  html:
    enabled: true
    follow_internal_links_only: true
    strip_selectors:
      - "nav"
      - "header"
      - "footer"
      - ".cookie-banner"
    min_text_length: 300

  pdf:
    enabled: true
    max_pages: 40
    ocr:
      enabled: false

  text_postprocessing:
    normalize_whitespace: true
    remove_control_chars: true

policy_filter:
  min_chars: 500
  max_chars: 30000
  keyword_config: "keywords.yml"
  require_climate_keyword: true

classification:
  measure_schema_config: "measure_schema.yml"
  digitalization_rules_config: "digitalization_rules.yml"

  baseline:
    strategy: "rule_based"
    ruleset: "rules/baseline_measures.yml"   # optional, später anlegen
    output_file: "data/de_sample/classified/measures_baseline.ndjson"

labeling:
  export:
    output_csv: "data/de_sample/labeling/policy_candidates_for_labeling.csv"
    fields:
      - "policy_id"
      - "municipality_id"
      - "source_url"
      - "snippet"
      - "predicted_label"

  import:
    labeled_csv: "data/de_sample/labeling/policy_candidates_labeled.csv"
    merge_output: "data/de_sample/classified/measures_labeled.ndjson"

evaluation:
  goldstandard_file: "data/de_sample/eval/gold_measures.ndjson"
  report_dir: "data/de_sample/eval/reports"
  metrics:
    - "precision"
    - "recall"
    - "f1"
    - "support"

llm:
  enabled: false
  config_file: "llm.yml"

# --- Kommunen-Definitionen (dein bisheriger Kern, unverändert inhaltlich) ---

municipalities:
  - id: karlsruhe
    name: "Stadt Karlsruhe"
    base_url: "https://www.karlsruhe.de"

    # geprüfter funktionierender Seed:
    seeds:
      - "https://www.karlsruhe.de/umwelt-klima"

    include_patterns:
      - "/umwelt"
      - "/umwelt-klima"
      - "/klima"
      - "/klimaschutz"
      - "/energie"
      - "/foerder"
      - "/förder"
      - "/umweltundklima"
      - "/nachhaltigkeit"

    exclude_patterns:
      - "/branchenbuch"
      - "/service/branchenbuch"
      - "/veranstaltungen"
      - "/sehenswuerdigkeiten"
      - "/weihnachten"
      - "/freizeit"
      - "/wetter"
      - "/kontakt"
      - "/impressum"
      - "/stellenportal"
      - "/karriere"
      - "/termin"
      - "/wahlen"
      - "/standesaemter"
      - "/sterbefall"
      - "/friedhoefe"

  - id: muenchen
    name: "Landeshauptstadt München"
    base_url: "https://stadt.muenchen.de"

    # dein geprüfter Startpunkt:
    seeds:
      - "https://stadt.muenchen.de/rathaus/verwaltung/referat-klima-umweltschutz.html"

    include_patterns:
      - "/klima"
      - "/klimaschutz"
      - "/energie"
      - "/foerder"
      - "/förder"
      - "/umwelt"
      - "/nachhaltigkeit"
      - "/foerderprogramm"
      - "/förderprogramm"

    exclude_patterns:
      - "/branchenbuch"
      - "/service/branchenbuch"
      - "/veranstaltungen"
      - "/freizeit"
      - "/sehenswuerdigkeiten"
      - "/weihnachten"
      - "/wetter"
      - "/kino"
      - "/konzerte"
      - "/tourismus"
      - "/jobs"
      - "/stellen"
      - "/impressum"
      - "/kontakt"
